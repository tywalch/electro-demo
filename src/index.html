<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>ElectroDB Playground</title>
        <meta name="description" content="">
        <meta property="og:title" content="">
        <meta property="og:type" content="">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <link rel="apple-touch-icon" href="icon.png">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="container">
            <div class="gap"></div>
            <div class="header">
                <img src="https://github.com/tywalch/electrodb/blob/master/assets/electrodb-drk.png?raw=true" style="height: 128.88px;"></h1>
<!--                <p>Reference the <i>ElectroDB</i> documentation <a href="https://github.com/tywalch/electrodb">here</a></p>-->
            </div>
            <div class="code">
                <iframe src="editor/index.html" frameborder="0" scrolling="no" sandbox="allow-scripts allow-same-origin" id="editor"> </iframe>
            </div>
            <div class="models-name"></div>
            <div class="display">
                <iframe src="display/index.html" frameborder="0" scrolling="yes" sandbox="allow-scripts allow-same-origin" id="display"></iframe>
            </div>
            <footer>
                <h4><a href="http://tinkertamper.com">Â© tinkertamper.com</a></h4>
            </footer>
        </div>
    </body>
    <script>
        const display = document.getElementById('display');
        const editor = document.getElementById("editor");
        let existingUrl = document.location.href;

        if (location.hash.startsWith('#code')) {
            editor.src = editor.src + location.hash;
        }

        function sendCode(message) {
            display.contentWindow.postMessage(message.data, '*');
        }

        function sendLink(message) {
            const url = `${document.location.protocol}//${document.location.host}${document.location.pathname}${message.data}`;
            console.log("replaceState", existingUrl !== url);
            if (existingUrl !== url) {
                existingUrl = url;
                window.history.replaceState({}, "", url);
            }
        }

        window.onmessage = function handleUpdates(e) {
            try {
                const message = JSON.parse(e.data);
                if (message.type === "code") {
                    sendCode(message);
                } else if (message.type === "query") {
                    sendLink(message)
                }
            } catch(err) {
                console.log({err, e});
            }
        }
    </script>
</html>